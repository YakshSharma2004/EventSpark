@model IEnumerable<EventSpark.Web.Models.MyTicketListItemViewModel>
@using EventSpark.Core.Enums
@using System.Linq;

@{
    ViewData["Title"] = "My Tickets";
}

<h1>My Tickets</h1>

@if (!Model.Any())
{
    <p>You do not have any tickets yet.</p>
}
else
{
    foreach (var t in Model.OrderByDescending(x => x.EventStartDateTime))
    {
        var statusClass = t.Status switch
        {
            TicketStatus.Active => "badge-ticket-active",
            TicketStatus.Cancelled => "badge-ticket-cancelled",
            TicketStatus.Refunded => "badge-ticket-refunded",
            _ => "bg-secondary"
        };
        <div class="card ticket-card">
            <div class="ticket-card-left">
                <div class="ticket-event-title">
                    @t.EventTitle
                </div>

                <div class="ticket-meta mb-1">
                    @t.EventStartDateTime.ToString("ddd, MMM dd yyyy h:mm tt")
                    @if (!string.IsNullOrWhiteSpace(t.VenueName))
                    {
                        <span> · @t.VenueName</span>
                    }
                </div>

                <div class="ticket-meta mb-1">
                    <strong>Ticket #:</strong> @t.TicketNumber
                    <span> · </span>
                    <strong>Type:</strong> @t.TicketTypeName
                </div>

                <div class="ticket-footer-row">
                    <div>
                        Order:
                        <a asp-action="Details"
                           asp-route-id="@t.OrderId">
                            #@t.OrderId
                        </a>
                    </div>
                    <span class="badge badge-ticket-status @statusClass">
                        @t.Status
                    </span>
                </div>
            </div>

            <div class="ticket-card-right">
                <img src="@Url.Action("TicketQr", "Orders", new { id = t.TicketId })"
                     alt="Ticket QR" />
            </div>
        </div>
    }
}
