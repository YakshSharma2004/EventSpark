@model EventSpark.Core.Entities.Event
@using EventSpark.Core.Enums
@using System.Security.Claims

@{
    ViewData["Title"] = "Event Details";

    var currentUserId = User.Identity?.IsAuthenticated == true
        ? User.FindFirstValue(ClaimTypes.NameIdentifier)
        : null;

    bool isOwner = !string.IsNullOrEmpty(currentUserId) && Model.OrganizerId == currentUserId;
    bool canBuy = Model.Status == EventStatus.Published;
}

@if (TempData["ErrorMessage"] is string error && !string.IsNullOrWhiteSpace(error))
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @error
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
<h1>@Model.Title</h1>

<dl class="row">
    <dt class="col-sm-2">City</dt>
    <dd class="col-sm-10">@Model.City</dd>

    <dt class="col-sm-2">Start</dt>
    <dd class="col-sm-10">@Model.StartDateTime</dd>

    <dt class="col-sm-2">End</dt>
    <dd class="col-sm-10">@Model.EndDateTime</dd>

    <dt class="col-sm-2">Status</dt>
    <dd class="col-sm-10">@Model.Status</dd>

    <dt class="col-sm-2">Venue</dt>
    <dd class="col-sm-10">@Model.VenueName (@Model.VenueAddress)</dd>

    <dt class="col-sm-2">Description</dt>
    <dd class="col-sm-10">@Model.Description</dd>
</dl>
<p>
    <a asp-action="Index" class="btn btn-secondary">Back to List</a>

    @if (!string.IsNullOrEmpty(currentUserId) && Model.OrganizerId == currentUserId)
    {
        <a asp-action="Edit" asp-route-id="@Model.EventId" class="btn btn-primary">Edit</a>
        <a asp-controller="CheckIn"
           asp-action="Index"
           asp-route-eventId="@Model.EventId"
           class="btn btn-outline-primary">
            Check-In
        </a>
    }
</p>
<p>
    <a asp-controller="Orders"
       asp-action="Purchase"
       asp-route-eventId="@Model.EventId"
       class="btn btn-success">
        Buy Tickets
    </a>
</p>
